{% extends 'base.html' %} {% load humanize %} {% block content %}
<div class="row mb-4">
  <div class="col-md-6 mb-3">
    <div class="card stat-card bg-white p-4">
      <h5 class="text-muted">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</h5>
      <h2 class="text-primary fw-bold">‡∏ø{{ weekly_income|intcomma }}</h2>
    </div>
  </div>
  <div class="col-md-6 mb-3">
    <div class="card stat-card bg-white p-4">
      <h5 class="text-muted">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h5>
      <h2 class="text-primary fw-bold">‡∏ø{{ monthly_income|intcomma }}</h2>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-8">
    <div class="card p-4 mb-4">
      <h4 class="mb-3">üìÖ ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏∏‡∏î‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</h4>
      <table class="table table-hover align-middle">
        <thead class="table-light">
          <tr>
            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡πà‡∏≤-‡∏Ñ‡∏∑‡∏ô</th>
            <th>‡∏ä‡∏∏‡∏î</th>
            <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody>
          {% for rental in upcoming_rentals %}
          <tr>
              <td>{{ rental.start_date|date:"d M" }} - {{ rental.end_date|date:"d M" }}</td>
            <td>
    <div class="fw-bold">{{ rental.dress.name }}</div>
    
    {% if rental.accessories.all %}
        <div class="mt-2 p-2 bg-light rounded border border-white">
            <small class="text-secondary d-block mb-1" style="font-size: 0.75rem;">
                <i class="bi bi-gift-fill text-danger"></i> ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ñ‡∏°:
            </small>
            
            <div class="d-flex flex-wrap gap-1">
                {% for acc in rental.accessories.all %}
                    {% if acc.image %}
                        <img src="{{ acc.image.url }}" 
                             class="rounded-circle border" 
                             style="width: 35px; height: 35px; object-fit: cover;"
                             data-bs-toggle="tooltip" 
                             title="{{ acc.name }}"> {% else %}
                        <span class="badge bg-secondary rounded-pill">{{ acc.name }}</span>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    {% endif %}
    </td>
            <td>{{ rental.customer.name }}</td>
            <td>
              <span
                class="badge {% if rental.status == 'BOOKED' %}bg-warning{% elif rental.status == 'ACTIVE' %}bg-info{% else %}bg-success{% endif %}"
              >
                {{ rental.get_status_display }}
              </span>
            </td>
            <td>
    {% if rental.status == 'BOOKED' %}
        <a href="{% url 'update_rental_status' rental.id 'ACTIVE' %}" class="btn btn-sm btn-outline-info rounded-pill mb-1">‡∏£‡∏±‡∏ö‡∏ä‡∏∏‡∏î</a>
    {% elif rental.status == 'ACTIVE' %}
        <a href="{% url 'update_rental_status' rental.id 'RETURNED' %}" class="btn btn-sm btn-outline-success rounded-pill mb-1">‡∏Ñ‡∏∑‡∏ô‡∏ä‡∏∏‡∏î</a>
    {% endif %}

    <a href="{% url 'delete_rental' rental.id %}" 
       class="btn btn-sm btn-outline-danger rounded-pill mb-1"
       onclick="return confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á {{ rental.customer.name }} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');">
       <i class="bi bi-trash"></i>
    </a>
</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="col-md-4">
    <div class="card p-4">
      <h4 class="mb-3">üí∞ ‡∏Å‡∏≥‡πÑ‡∏£‡∏£‡∏≤‡∏¢‡∏ä‡∏∏‡∏î</h4>
      <div style="max-height: 400px; overflow-y: auto">
        {% for dress in dresses %}
        <div class="d-flex align-items-center mb-3 border-bottom pb-2">
          {% if dress.image %}
          <img
            src="{{ dress.image.url }}"
            class="rounded-circle me-2"
            width="40"
            height="40"
            style="object-fit: cover"
          />
          {% endif %}
          <div class="flex-grow-1">
            <div class="fw-bold">{{ dress.name }}</div>
            <small class="text-muted"
              >‡∏ó‡∏∏‡∏ô: {{ dress.cost_price|intcomma }}</small
            >
          </div>
          <div class="text-end">
            {% with p=dress.profit %}
            <span
              class="fw-bold {% if p >= 0 %}text-success{% else %}text-danger{% endif %}"
            >
              {{ p|intcomma }}
            </span>
            {% endwith %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<script>
    // ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Tooltip ‡∏Ç‡∏≠‡∏á Bootstrap
    document.addEventListener("DOMContentLoaded", function(){
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl)
        })
    });
</script>
{% endblock %}
